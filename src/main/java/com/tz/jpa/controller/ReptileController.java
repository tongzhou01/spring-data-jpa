package com.tz.jpa.controller;

import com.alibaba.fastjson.JSON;
import com.tz.jpa.util.ReptileUtil;
import org.springframework.web.bind.annotation.*;

import java.io.UnsupportedEncodingException;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

/**
 * ReptileController
 *
 * @author:tongzhou
 * @date: 2019/08/14
 * @description:
 */
@RestController
@RequestMapping("/reptile")
public class ReptileController {

    @PostMapping
    public void downloadImageByNames(@RequestBody List<String> names) throws UnsupportedEncodingException {
        for (String name : names) {
            try {
                List<String> personUrl = ReptileUtil.getPersonCodeByName(name);
                if (personUrl == null) {
                    System.err.println(names + "----未找到");
                    continue;
                }
//                String html = ReptileUtil.download(personUrl);
//                ReptileUtil.getPersonImage(html, name);
            } catch (Exception e) {
                System.out.println(e.toString());
            }
        }
    }

    @GetMapping("/code")
    public Map<String, List<String>> getPersonCodeByNames(@RequestBody List<String> names) throws UnsupportedEncodingException {
        Map map = new HashMap();
        for (String name : names) {
            try {
                List<String> personUrls = ReptileUtil.getPersonCodeByName(name);
                if (personUrls == null || personUrls.size() == 0) {
                    System.err.println(names + "----未找到");
                    continue;
                }
                List<String> codeList = new ArrayList<>();
                for (String personUrl : personUrls) {
                    String code = "";
                    if (personUrl.endsWith("/")) {
                        personUrl = personUrl.substring(0, personUrl.length() - 1);
                    }
                    code = personUrl.substring(personUrl.lastIndexOf("/") + 1);
                    codeList.add(code);
                }
                map.put(name, codeList);
            } catch (Exception e) {
                System.out.println(e.toString());
            }
        }
        return map;
    }

    @PostMapping("/map")
    public void downloadImageById(@RequestBody Map<String, String> data) throws UnsupportedEncodingException {
        data.forEach((name, id) -> {
            String url = "https://movie.douban.com/celebrity/"+ id + "/";
            try {
                String html = ReptileUtil.download(url);
                ReptileUtil.getPersonImage(html, name);
            } catch (Exception e) {
                System.out.println(e.toString());
            }
        });
    }

    public static void main(String[] args) {
        /*int[][] array = {
                {7},
                {3,8},
                {8,1,0},
                {2,7,4,4},
                {4,5,2,6,5}
        };
        for (int i = 0; i < array.length; i++) {
            int total = 0;
            for (int j = 0; j < array[i + 1].length; j++) {
                total = array[i][i] + array[i+1][j];
            }
        }*/
        String json = "{\n" +
                "    \"胡盛\": [\n" +
                "        \"1416946\"\n" +
                "    ],\n" +
                "    \"周三友\": [\n" +
                "        \"1418871\"\n" +
                "    ],\n" +
                "    \"时男\": [\n" +
                "        \"1397127\"\n" +
                "    ],\n" +
                "    \"王尼玛\": [\n" +
                "        \"1343523\"\n" +
                "    ],\n" +
                "    \"左颂升\": [\n" +
                "        \"1330805\"\n" +
                "    ],\n" +
                "    \"陈晓\": [\n" +
                "        \"1325412\",\n" +
                "        \"1395129\",\n" +
                "        \"1319627\",\n" +
                "        \"1076555\",\n" +
                "        \"1400561\",\n" +
                "        \"1043713\",\n" +
                "        \"1071368\",\n" +
                "        \"1349288\",\n" +
                "        \"1349293\",\n" +
                "        \"1395363\",\n" +
                "        \"1384703\",\n" +
                "        \"1371781\",\n" +
                "        \"1368008\",\n" +
                "        \"1350231\",\n" +
                "        \"1316580\"\n" +
                "    ],\n" +
                "    \"王景晨\": [\n" +
                "        \"1416944\"\n" +
                "    ],\n" +
                "    \"吴镇宇\": [\n" +
                "        \"1037098\"\n" +
                "    ],\n" +
                "    \"林育贤\": [\n" +
                "        \"1315733\"\n" +
                "    ],\n" +
                "    \"宋芸桦\": [\n" +
                "        \"1341903\"\n" +
                "    ],\n" +
                "    \"宋楠惜\": [\n" +
                "        \"1361841\"\n" +
                "    ],\n" +
                "    \"张敏\": [\n" +
                "        \"1005297\",\n" +
                "        \"1320966\",\n" +
                "        \"1330109\",\n" +
                "        \"1360911\",\n" +
                "        \"1406526\",\n" +
                "        \"1400330\",\n" +
                "        \"1315206\",\n" +
                "        \"1402439\",\n" +
                "        \"1345575\",\n" +
                "        \"1418458\",\n" +
                "        \"1053862\",\n" +
                "        \"1366848\",\n" +
                "        \"1353625\",\n" +
                "        \"1374659\",\n" +
                "        \"1413099\"\n" +
                "    ],\n" +
                "    \"林妍柔\": [\n" +
                "        \"1356553\"\n" +
                "    ],\n" +
                "    \"午马\": [\n" +
                "        \"1054282\"\n" +
                "    ],\n" +
                "    \"皮逸嘉\": [\n" +
                "        \"1347659\"\n" +
                "    ],\n" +
                "    \"孙兴\": [\n" +
                "        \"1150721\",\n" +
                "        \"1410106\"\n" +
                "    ],\n" +
                "    \"闫妮\": [\n" +
                "        \"1274496\",\n" +
                "        \"1360080\"\n" +
                "    ],\n" +
                "    \"尹恒\": [\n" +
                "        \"1330710\"\n" +
                "    ],\n" +
                "    \"尹天照\": [\n" +
                "        \"1275698\"\n" +
                "    ],\n" +
                "    \"陈浩\": [\n" +
                "        \"1329520\",\n" +
                "        \"1386439\",\n" +
                "        \"1339568\",\n" +
                "        \"1357090\",\n" +
                "        \"1274567\",\n" +
                "        \"1323737\",\n" +
                "        \"1373489\",\n" +
                "        \"1343503\",\n" +
                "        \"1334405\",\n" +
                "        \"1416027\",\n" +
                "        \"1388982\",\n" +
                "        \"1351411\",\n" +
                "        \"1368853\",\n" +
                "        \"1382375\",\n" +
                "        \"1410034\"\n" +
                "    ],\n" +
                "    \"向华强\": [\n" +
                "        \"1037691\"\n" +
                "    ],\n" +
                "    \"倪匡\": [\n" +
                "        \"1275879\"\n" +
                "    ],\n" +
                "    \"苗可秀\": [\n" +
                "        \"1005207\"\n" +
                "    ],\n" +
                "    \"阮继志\": [\n" +
                "        \"1322097\"\n" +
                "    ],\n" +
                "    \"龙子乔\": [\n" +
                "        \"1308172\"\n" +
                "    ],\n" +
                "    \"邓超\": [\n" +
                "        \"1274235\",\n" +
                "        \"1391670\",\n" +
                "        \"1361257\"\n" +
                "    ],\n" +
                "    \"鹤男\": [\n" +
                "        \"1415884\"\n" +
                "    ],\n" +
                "    \"刘兆铭\": [\n" +
                "        \"1313719\"\n" +
                "    ],\n" +
                "    \"裴蒂·赫格莉\": [\n" +
                "        \"1400572\"\n" +
                "    ],\n" +
                "    \"岳红\": [\n" +
                "        \"1052863\"\n" +
                "    ],\n" +
                "    \"林晓峰\": [\n" +
                "        \"1029805\"\n" +
                "    ],\n" +
                "    \"林威\": [\n" +
                "        \"1289306\",\n" +
                "        \"1370199\",\n" +
                "        \"1389445\"\n" +
                "    ],\n" +
                "    \"姚以缇\": [\n" +
                "        \"1355368\"\n" +
                "    ],\n" +
                "    \"倪颂夏\": [\n" +
                "        \"1418870\"\n" +
                "    ],\n" +
                "    \"马少骅\": [\n" +
                "        \"1274966\"\n" +
                "    ],\n" +
                "    \"冯远征\": [\n" +
                "        \"1043136\"\n" +
                "    ],\n" +
                "    \"金巴\": [\n" +
                "        \"1362878\",\n" +
                "        \"1411073\",\n" +
                "        \"1041095\",\n" +
                "        \"1356442\",\n" +
                "        \"1355430\",\n" +
                "        \"1366860\"\n" +
                "    ],\n" +
                "    \"钟镇涛\": [\n" +
                "        \"1033223\"\n" +
                "    ],\n" +
                "    \"王凯阳\": [\n" +
                "        \"1350019\"\n" +
                "    ],\n" +
                "    \"乐思宏\": [\n" +
                "        \"1375965\"\n" +
                "    ],\n" +
                "    \"金士杰\": [\n" +
                "        \"1275482\"\n" +
                "    ],\n" +
                "    \"王西\": [\n" +
                "        \"1414875\",\n" +
                "        \"1380064\",\n" +
                "        \"1398816\"\n" +
                "    ],\n" +
                "    \"沙俊伯\": [\n" +
                "        \"1363048\"\n" +
                "    ],\n" +
                "    \"元奎\": [\n" +
                "        \"1289150\"\n" +
                "    ],\n" +
                "    \"才多\": [\n" +
                "        \"1402634\"\n" +
                "    ],\n" +
                "    \"朱丽岚\": [\n" +
                "        \"1361339\"\n" +
                "    ],\n" +
                "    \"刘玉婷\": [\n" +
                "        \"1109767\",\n" +
                "        \"1339301\"\n" +
                "    ],\n" +
                "    \"胡建群\": [\n" +
                "        \"1418869\"\n" +
                "    ],\n" +
                "    \"静芳\": [\n" +
                "        \"1416285\"\n" +
                "    ],\n" +
                "    \"杜鹃\": [\n" +
                "        \"1323516\",\n" +
                "        \"1316139\"\n" +
                "    ],\n" +
                "    \"周拉多杰\": [\n" +
                "        \"1396554\"\n" +
                "    ],\n" +
                "    \"唐晶\": [\n" +
                "        \"1396234\"\n" +
                "    ],\n" +
                "    \"季晨\": [\n" +
                "        \"1323190\"\n" +
                "    ],\n" +
                "    \"刘林城\": [\n" +
                "        \"1407788\"\n" +
                "    ],\n" +
                "    \"李佳繁\": [\n" +
                "        \"1420031\"\n" +
                "    ],\n" +
                "    \"邵兵\": [\n" +
                "        \"1274884\"\n" +
                "    ],\n" +
                "    \"罗维\": [\n" +
                "        \"1328734\",\n" +
                "        \"1050286\",\n" +
                "        \"1375846\",\n" +
                "        \"1045010\",\n" +
                "        \"1409837\",\n" +
                "        \"1411257\",\n" +
                "        \"1414422\",\n" +
                "        \"1358079\"\n" +
                "    ],\n" +
                "    \"林青霞\": [\n" +
                "        \"1044746\"\n" +
                "    ],\n" +
                "    \"田馨\": [\n" +
                "        \"1418872\"\n" +
                "    ],\n" +
                "    \"王珞嘉\": [\n" +
                "        \"1391235\"\n" +
                "    ],\n" +
                "    \"梁朝伟\": [\n" +
                "        \"1115918\"\n" +
                "    ],\n" +
                "    \"艾伦\": [\n" +
                "        \"1049903\",\n" +
                "        \"1350408\",\n" +
                "        \"1054430\",\n" +
                "        \"1012520\",\n" +
                "        \"1025153\",\n" +
                "        \"1006980\",\n" +
                "        \"1017981\",\n" +
                "        \"1004765\",\n" +
                "        \"1053577\",\n" +
                "        \"1264969\",\n" +
                "        \"1275018\",\n" +
                "        \"1004635\",\n" +
                "        \"1025215\",\n" +
                "        \"1002730\",\n" +
                "        \"1041104\"\n" +
                "    ],\n" +
                "    \"焦雯倩\": [\n" +
                "        \"1406076\"\n" +
                "    ],\n" +
                "    \"何润东\": [\n" +
                "        \"1050590\"\n" +
                "    ],\n" +
                "    \"尹扬明\": [\n" +
                "        \"1313041\"\n" +
                "    ],\n" +
                "    \"段超\": [\n" +
                "        \"1416945\"\n" +
                "    ],\n" +
                "    \"程媛媛\": [\n" +
                "        \"1313238\"\n" +
                "    ],\n" +
                "    \"李川江\": [\n" +
                "        \"1357094\"\n" +
                "    ],\n" +
                "    \"张冬\": [\n" +
                "        \"1399017\",\n" +
                "        \"1415677\"\n" +
                "    ],\n" +
                "    \"华少\": [\n" +
                "        \"1322856\",\n" +
                "        \"1366050\"\n" +
                "    ],\n" +
                "    \"黄正利\": [\n" +
                "        \"1037123\"\n" +
                "    ],\n" +
                "    \"金春花\": [\n" +
                "        \"1357159\"\n" +
                "    ],\n" +
                "    \"彭杨\": [\n" +
                "        \"1321153\"\n" +
                "    ],\n" +
                "    \"石班瑜\": [\n" +
                "        \"1274430\"\n" +
                "    ],\n" +
                "    \"叶德娴\": [\n" +
                "        \"1016864\"\n" +
                "    ],\n" +
                "    \"田俊\": [\n" +
                "        \"1352930\",\n" +
                "        \"1275596\"\n" +
                "    ],\n" +
                "    \"黄磊\": [\n" +
                "        \"1037715\"\n" +
                "    ],\n" +
                "    \"黄哈\": [\n" +
                "        \"1374071\"\n" +
                "    ],\n" +
                "    \"石天\": [\n" +
                "        \"1146001\",\n" +
                "        \"1319281\",\n" +
                "        \"1315476\",\n" +
                "        \"1317162\",\n" +
                "        \"1332692\",\n" +
                "        \"1344366\"\n" +
                "    ],\n" +
                "    \"王祖贤\": [\n" +
                "        \"1166896\"\n" +
                "    ],\n" +
                "    \"王洪千\": [\n" +
                "        \"1376431\"\n" +
                "    ],\n" +
                "    \"柯达\": [\n" +
                "        \"1340746\",\n" +
                "        \"1050346\",\n" +
                "        \"1288805\",\n" +
                "        \"1356972\",\n" +
                "        \"1338495\",\n" +
                "        \"1012785\"\n" +
                "    ],\n" +
                "    \"袁和平\": [\n" +
                "        \"1275026\"\n" +
                "    ],\n" +
                "    \"陈锦昀\": [\n" +
                "        \"1374406\"\n" +
                "    ],\n" +
                "    \"白宇\": [\n" +
                "        \"1337887\",\n" +
                "        \"1392509\",\n" +
                "        \"1411408\",\n" +
                "        \"1405549\"\n" +
                "    ],\n" +
                "    \"曹天恺\": [\n" +
                "        \"1408457\"\n" +
                "    ],\n" +
                "    \"俞白眉\": [\n" +
                "        \"1316617\"\n" +
                "    ],\n" +
                "    \"东主才郎\": [\n" +
                "        \"1402635\"\n" +
                "    ],\n" +
                "    \"王建国\": [\n" +
                "        \"1385701\",\n" +
                "        \"1323094\",\n" +
                "        \"1302449\"\n" +
                "    ],\n" +
                "    \"李小龙\": [\n" +
                "        \"1036369\",\n" +
                "        \"1322910\"\n" +
                "    ],\n" +
                "    \"孙浠伦\": [\n" +
                "        \"1384585\"\n" +
                "    ],\n" +
                "    \"雷宇扬\": [\n" +
                "        \"1121730\"\n" +
                "    ],\n" +
                "    \"关之琳\": [\n" +
                "        \"1028064\"\n" +
                "    ],\n" +
                "    \"绿绮\": [\n" +
                "        \"1372724\"\n" +
                "    ],\n" +
                "    \"张迪\": [\n" +
                "        \"1315701\",\n" +
                "        \"1373488\",\n" +
                "        \"1276154\",\n" +
                "        \"1371147\",\n" +
                "        \"1413757\"\n" +
                "    ],\n" +
                "    \"姜明月\": [\n" +
                "        \"1357093\"\n" +
                "    ],\n" +
                "    \"霍建起\": [\n" +
                "        \"1006351\"\n" +
                "    ],\n" +
                "    \"韩童生\": [\n" +
                "        \"1274722\"\n" +
                "    ],\n" +
                "    \"张可颐\": [\n" +
                "        \"1073994\"\n" +
                "    ],\n" +
                "    \"刘德华\": [\n" +
                "        \"1054424\"\n" +
                "    ],\n" +
                "    \"王嘉\": [\n" +
                "        \"1367682\",\n" +
                "        \"1315639\",\n" +
                "        \"1343514\",\n" +
                "        \"1317520\",\n" +
                "        \"1373610\",\n" +
                "        \"1348953\",\n" +
                "        \"1409360\",\n" +
                "        \"1319312\",\n" +
                "        \"1365644\",\n" +
                "        \"1343836\",\n" +
                "        \"1363162\",\n" +
                "        \"1345025\",\n" +
                "        \"1389844\",\n" +
                "        \"1359521\",\n" +
                "        \"1369452\"\n" +
                "    ],\n" +
                "    \"楼南光\": [\n" +
                "        \"1289501\"\n" +
                "    ],\n" +
                "    \"吴文\": [\n" +
                "        \"1324409\",\n" +
                "        \"1380689\",\n" +
                "        \"1027665\",\n" +
                "        \"1341235\",\n" +
                "        \"1293117\",\n" +
                "        \"1348004\",\n" +
                "        \"1357312\",\n" +
                "        \"1378431\",\n" +
                "        \"1409016\",\n" +
                "        \"1328396\",\n" +
                "        \"1374807\",\n" +
                "        \"1329601\",\n" +
                "        \"1403810\",\n" +
                "        \"1418628\",\n" +
                "        \"1413489\"\n" +
                "    ],\n" +
                "    \"宋威龙\": [\n" +
                "        \"1353488\"\n" +
                "    ],\n" +
                "    \"赵静蓉\": [\n" +
                "        \"1321360\"\n" +
                "    ],\n" +
                "    \"姚骆铭\": [\n" +
                "        \"1420017\"\n" +
                "    ],\n" +
                "    \"林枫烨\": [\n" +
                "        \"1400559\"\n" +
                "    ],\n" +
                "    \"宣萱\": [\n" +
                "        \"1023521\"\n" +
                "    ],\n" +
                "    \"代梦颖\": [\n" +
                "        \"1365466\"\n" +
                "    ],\n" +
                "    \"杜亭君\": [\n" +
                "        \"1420032\"\n" +
                "    ],\n" +
                "    \"冯俊杰\": [\n" +
                "        \"1376240\"\n" +
                "    ],\n" +
                "    \"程小东\": [\n" +
                "        \"1280664\"\n" +
                "    ],\n" +
                "    \"黄俊捷\": [\n" +
                "        \"1365468\"\n" +
                "    ],\n" +
                "    \"马苏\": [\n" +
                "        \"1275459\",\n" +
                "        \"1288562\",\n" +
                "        \"1343328\",\n" +
                "        \"1411017\",\n" +
                "        \"1394467\"\n" +
                "    ],\n" +
                "    \"崔新琴\": [\n" +
                "        \"1334972\"\n" +
                "    ],\n" +
                "    \"邱淑贞\": [\n" +
                "        \"1048296\"\n" +
                "    ],\n" +
                "    \"罗嘉良\": [\n" +
                "        \"1038521\"\n" +
                "    ],\n" +
                "    \"蒋毓玮\": [\n" +
                "        \"1391523\"\n" +
                "    ]\n" +
                "}";
        Map<String, List<String>> map = JSON.parseObject(json, Map.class);
        map.forEach((s, list) -> {
            if (list.size() > 1) {
                System.out.println(s);
            }
        });
    }
}
